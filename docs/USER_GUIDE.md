# 家庭健康管理中台 - 用户使用说明

## 1. 登录、注册与首次初始化
1. 打开前端页面。
2. 新用户：点击 `去注册`，注册成功后切换到 `去登录`。
3. 登录后进入四中心工作区。
4. 如需兼容旧流程，仍可使用 `初始化 Owner`（仅首次可用），但不是日常必需。

## 2. 设置中心（所有用户可用）
1. 在左侧进入 `设置中心`。
2. 在 `供应商` 页签可新增/搜索/刷新/更新/删除 Provider。
3. 新增 Provider 时可先选 `预置供应商` 自动填充端点（Gemini/OpenAI/Zhipu/SiliconFlow/OpenRouter）。
4. 选择 `Custom` 后可手工填写完整 `Provider + Base URL + API Key`，可持续新增多个不同端点配置。
5. 在 `模型选择` 页签，从下拉框选择 LLM/Embedding/Reranker 创建 Runtime Profile。
6. 在 `MCP 工具` 页签：
   - 手工新增时填写 `启动命令` 和 `启动参数`，系统会自动生成 MCP 配置（无需手填 endpoint）。
   - 粘贴 MCP JSON 模板批量导入（如 `command=npx` + `args=[...]`）。
   - 选择并保存 QA Agent 绑定。

## 3. 聊天中心
1. 点击 `新建` 创建会话前，可先选择 `医学角色`（来自后端 Markdown 角色库）。
2. 如需自定义，可在 `自定义角色提示词（会话级）` 输入专属提示词。
3. 可配置会话级思维参数：`Reasoning switch`、`Reasoning budget`、`Show reasoning stream`。
4. 点击 `新建` 后，会话会绑定所选角色/自定义提示词和思维参数。
5. 会话支持配置 `上下文记忆轮数`（建议 20-50），保存后该会话按该轮数截取历史上下文。
6. MCP 选择已移动到聊天输入框上方图标区，可在发送前快速切换。
7. 附件上传已集成到 ChatBox（回形针图标），也支持在输入框直接粘贴文件上传。
8. 图片附件仅在当前会话所用模型具备多模态能力时允许上传；非多模态模型会直接提示并阻止上传。
9. 发送问题时，角色提示词仅作为系统上下文，不会显示在消息流里；回答使用流式输出。
10. 每条消息支持：复制、导出 Markdown、导出 PDF（浏览器打印另存为 PDF）。
11. 可勾选多条消息并一键分享，系统会生成包含会话与消息 ID 的分享链接并复制到剪贴板。
12. 会话导出支持在会话行内选择格式（Markdown / PDF）并选择是否保留思维链。
13. ChatBox 支持知识库选择（可不选），发送后会将选中的知识库检索结果用于本轮 QA。
14. 支持两种发送模式：
   - 普通问答：输入问题后发送。
   - 仅附件模式：问题留空，但上传附件后发送。

## 4. 知识库中心
1. 在知识库列表可新建、选择、删除知识库（图标按钮）。
2. 进入某个知识库后，可编辑并保存专用参数：
   - Chunk 大小、Overlap、TopK、Rerank TopN
   - Embedding / Reranker / 语义检索 LLM 模型
   - 检索策略（`keyword` / `semantic` / `hybrid`）与权重
3. 可勾选 `使用全局默认参数`，让该知识库自动继承全局默认配置；也可关闭后手动覆盖为专用配置。
4. 构建支持两种输入：
   - 文本构建：填写标题+内容后点击 `用文本构建`
   - 文档上传：直接上传文档（推荐 Markdown，也支持常见文本/docx）
5. 文档列表支持删除单条文档（图标按钮）。
6. 检索测试会按策略+权重返回结果，可快速对比关键词与语义混合效果。

## 5. 导出中心
1. 选择导出类型（聊天记录、知识库文档）。
2. 设置是否包含原始文件与脱敏文本。
3. 点击 `创建打包任务`。
4. 在任务列表可下载 ZIP 或删除任务。

## 6. 常见问题
- 登录失败：确认后端已启动，账号是否存在。
- Provider 新增返回 401：当前登录 token 已失效或缺失，请重新登录后重试。
- MCP 创建/绑定返回 401：同样是登录状态失效，请重新登录后重试。
- 页面连续出现多个 401：系统会自动清理失效会话并返回登录页，重新登录即可恢复。
- 附件上传失败：可能命中未脱敏敏感信息，请先在设置中心增加脱敏规则。
- 空消息无法发送：请至少输入问题，或先上传附件后以“仅附件模式”发送。
- 导出下载失败：任务必须先进入 `done` 状态。
- 看不到别人的模型/MCP/聊天/知识库：这是预期行为，系统按用户隔离数据与配置。
